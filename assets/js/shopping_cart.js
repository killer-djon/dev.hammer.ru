jQuery(document).ready(function(){jQuery(".add_to_cart").click(function(){var g=jQuery(this).closest("form");var f=jQuery(this);console.log(g);jQuery.ajax({url:"/widget/cart/add",type:"POST",dataType:"json",data:{id:g.find("[name=id]").val(),qty:g.find("[name=qty]").val(),article:g.find("[name=article]").val(),name:g.find("[name=name]").val(),price:g.find("[name=price]").val(),},success:function(h,i){if(i){c();jQuery.notify({message:"Деталь успешно добавлена в корзину",},{placement:{from:"bottom",align:"left"},animate:{enter:"animated fadeInUp",exit:"animated fadeOutDown"},z_index:1001,delay:1000});f.closest(".dropdown").removeClass("open")}}});return false});function c(){jQuery.ajax({url:"/widget/cart/content",type:"POST",dataType:"json",success:function(f,g){if(g){jQuery("#cart-total, #shopping-cart-total-icon, #shopping-cart-total").html(f.result)}}})}c();function b(f){jQuery.ajax({url:"/widget/cart/delete",type:"POST",dataType:"json",data:{id:f},success:function(g,i){if(i){var h=g.cart_data.total;jQuery("#cart-items table").find('tr[data-row="'+f+'"]').remove();c();jQuery.notify({message:"Деталь успешно удалена из корзины",},{placement:{from:"top",align:"center"},animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"},z_index:1001,delay:1000});jQuery("#removeProduct").modal("hide");if(h.count==0){jQuery("#clear-cart").trigger("click")}}}})}jQuery(".remove-item").click(function(){var f=jQuery(this).closest("tr.row-item-detail");var g=f.find("[name=price]").val();jQuery("#removeProduct").find("table span.name").text(f.find("[name=name]").val());jQuery("#removeProduct").find("[name=id]").val(f.find("[name=id]").val());jQuery("#removeProduct").find("table span.article").text(f.find("[name=article]").val());jQuery("#removeProduct").find("table span.price").text((g=="0,00"?"Под заказ":g+" руб."))});jQuery("#shopping-cart-page").on("click",".cart-qty",function(){var g=jQuery(this).closest(".count-detail").find("[name=qty]");var f=jQuery(this).closest(".form-group");var h=(g.val()).replace(/([^\d+])/ig,"");if(jQuery(this).hasClass("cart-refresh")){g.val(jQuery(this).closest(".count-detail").prevAll("[name=data-qty]").val())}d(f.closest("tbody"))});function d(f){$.each(f.find("tr.row-item-detail"),function(i,h){jQuery(h).find("td:first").text((i+1));var j=jQuery(h).find("[name=qty]").val();var g=jQuery(h).find("[name=data-qty]").val();if(j!=g){jQuery(h).find("td.count-item").addClass("bg-danger")}else{jQuery(h).find("td.count-item").removeClass("bg-danger")}})}jQuery("#clear-cart").click(function(){jQuery.ajax({url:"/widget/cart/clear",type:"POST",dataType:"json",success:function(f,g){if(g){c()}location.reload()}})});jQuery("#refresh-cart").click(function(){var g=jQuery(".cart_content_form");var f={};g.find("tr.row-item-detail").each(function(i,h){f[i]={id:jQuery(h).attr("data-row"),qty:jQuery(h).find("[name=qty]").val(),}});jQuery.ajax({url:"/widget/cart/update",type:"POST",dataType:"json",data:f,success:function(h,j){if(j){c();var i=h.cart_data;if(i&&i.products){$.each(i.products,function(k,o){var n=g.find('tr[data-row="'+k+'"]');var m=parseInt(o.qty);var l=parseFloat(o.price);jQuery(n).find("[name=data-qty]").val(o.qty);jQuery(n).find(".subtotal-item").text((m*l).toFixed(2).replace(/\./g,",")+" руб.");jQuery(n).find(".cart-refresh").trigger("click")});g.find(".total-count > strong").text(i.total.count);g.find(".total-cost > strong").text((i.total.price).toFixed(2).replace(/\./g,","))}}}})});jQuery("#removeProduct").on("click","#remove-product",function(){b(jQuery("#removeProduct").find('[name="id"]').val());return false});d(jQuery("#cart-items").find("table tbody"));var a=jQuery('select[name="shipping-method"]').val();e(a);function e(f){var g=jQuery('select[name="shipping-method"] option[value="'+f+'"]');console.log(g);if(g!=undefined&&g.length>0){var h=g.attr("data-target").substr(1);jQuery('select[name="shipping-method"]').closest("#accordion-shipping").find(".panel-collapse").removeClass("in");jQuery("#"+h).addClass("in")}}jQuery("#auth-form, #personal-data").submit(function(){var g=jQuery(this);var f=jQuery('[name="shipping-method"]');jQuery(this).find("input.shipping").remove();jQuery(g).prepend('<input type="hidden" name="shipping_method" value="'+f.find('option[value="'+f.val()+'"]').text()+'">');if(f.val()=="2"){var h=jQuery("#shipping-method-form").serializeArray();jQuery(h).each(function(i,j){jQuery(g).prepend('<input type="hidden" name="'+j.name+'" value="'+j.value+'">')})}})});